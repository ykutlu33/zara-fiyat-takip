name: Zara Fiyat Takip

on:
  schedule:
    - cron: '*/5 * * * *'
  workflow_dispatch:

jobs:
  check-price:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: pip install requests
      
      - name: Get last price
        run: |
          if [ -f price.txt ]; then
            echo "LAST_PRICE=$(cat price.txt)" >> $GITHUB_ENV
          fi
      
      - name: Run tracker
        env:
          LAST_PRICE: ${{ env.LAST_PRICE }}
        run: |
          python << 'EOF'
          import requests
          import re
          import os

          TELEGRAM_BOT_TOKEN = "8375130122:AAHXVaMo-XXZvkd-MEsoOdEVpdtkqc50psg"
          TELEGRAM_CHAT_ID = "1234645010"
          PRODUCT_URL = "https://www.zara.com/tr/tr/hayvan-desenli-kisa-suni-kurk-kaban-zw-collection-p04369240.html?v1=489488534"

          def send_telegram(message):
              url = f"https://api.telegram.org/bot{TELEGRAM_BOT_TOKEN}/sendMessage"
              requests.post(url, json={'chat_id': TELEGRAM_CHAT_ID, 'text': message, 'parse_mode': 'HTML'}, timeout=10)
              print("Telegram gÃ¶nderildi!")

          def get_price():
              headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'}
              response = requests.get(PRODUCT_URL, headers=headers, timeout=30)
              prices = re.findall(r'(\d{1,3}(?:\.\d{3})*,\d{2})\s*TL', response.text)
              if prices:
                  float_prices = [float(p.replace('.', '').replace(',', '.')) for p in prices]
                  return min(float_prices)
              return None

          def format_price(price):
              return f"{price:,.2f} TL".replace(',', 'X').replace('.', ',').replace('X', '.')

          price = get_price()
          if price:
              print(f"Fiyat: {format_price(price)}")
              last = os.environ.get('LAST_PRICE', '')
              if last and float(last) != price:
                  change = price - float(last)
                  pct = (change / float(last)) * 100
                  emoji = "ðŸŽ‰ðŸ“‰ DÃœÅžTÃœ" if change < 0 else "ðŸ“ˆ ARTTI"
                  msg = f"{emoji}!\n\nEski: {format_price(float(last))}\nYeni: {format_price(price)}\n\nFark: {format_price(abs(chang
